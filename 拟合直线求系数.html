<html>
  <head>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"  name="viewport" />
    <!--script src="https://cdn.bootcss.com/vConsole/3.3.4/vconsole.min.js"></script-->
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.bootcss.com/tensorflow/1.2.10/tf.min.js"> </script>

    <!-- Place your code in the script tag below. You can also use an external .js file -->
    <script>
      //new VConsole()
     </script>
    <script>
      //训练参数
      const xsRaw = tf.tensor([2013, 2014, 2015, 2016, 2017])
      const ysRaw = tf.tensor([12000, 14000, 15000, 16500, 17500])

      // 归一化(x[]-x[min])/(x[max]-x[min])
      const xs = xsRaw.sub(xsRaw.min())
                      .div(xsRaw.max().sub(xsRaw.min()))
      const ys = ysRaw.sub(ysRaw.min())
                      .div(ysRaw.max().sub(ysRaw.min()))
      //预先声明随机系数变量值
      const a = tf.scalar(Math.random()).variable()
      const b = tf.scalar(Math.random()).variable()
      
      //定义预测函数
      // y = a * x + b.
      const f = (x) => a.mul(x).add(b)
      //定义损失函数
      const loss = (pred, label) => pred.sub(label).square().mean()

      //定义随机梯度下降
      const learningRate = 1e-3
      const optimizer = tf.train.sgd(learningRate)

      // 训练模型
      for (let i = 0; i < 10000; i++) {
         optimizer.minimize(() => loss(f(xs), ys))
      }

      // 预测
      console.log(`a: ${a.dataSync()}, b: ${b.dataSync()}`)
      const preds = f(xs).dataSync()
      const trues = ys.arraySync()
      preds.forEach((pred, i) => {
         console.log(`x: ${i}, pred: ${pred.toFixed(2)}, true: ${trues[i].toFixed(2)}`)
      })
    </script>
    </script>
  </head>

  <body>
  </body>
</html>
